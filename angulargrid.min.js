/*
    angularGrid.js v 0.5.0
    Author: Sudhanshu Yadav
    Copyright (c) 2015 Sudhanshu Yadav - ignitersworld.com , released under the MIT license.
    Demo on: http://ignitersworld.com/lab/angulargrid/demo1.html
    Documentation and download on https://github.com/s-yadav/angulargrid
*/

!function(n,t,i){"use strict";function o(n){return n.complete&&("undefined"==typeof n.naturalWidth||0!==n.naturalWidth)}function e(n){return Array.prototype.slice.call(n)}var r={gridWidth:300,gutterSize:10,gridNo:"auto",direction:"ltor",refreshOnImgLoad:!0,cssGrid:!1},a=n.element,d={visibility:"hidden",opacity:0,top:0,left:0,width:""},l=function(){var n=a(t);return function(t){return n[0]=t,n}}();a(document.head).append("<style>.ag-no-transition{-webkit-transition: none !important;transition: none !important;} .angular-grid{position : relative;} .angular-grid > *{opacity : 0} .angular-grid > .angular-grid-item{opacity : 1}</style>"),n.module("angularGrid",[]).directive("angularGrid",["$timeout","$window","$q","angularGridInstance",function(s,c,u,f){return{restrict:"A",scope:{model:"=angularGrid",gridWidth:"=",gutterSize:"=",refreshOnImgLoad:"=",direction:"=",cssGrid:"=",options:"=angularGridOptions",infiniteScroll:"&"},link:function(g,h,m){function p(){F={},Object.keys(r).forEach(function(n){g[n]!=i&&(F[n]=g[n])}),F=n.extend({},r,F,g.options),F.cssGrid&&(F.gutterSize=0)}function v(){var n,t=b.offsetWidth;if(F.cssGrid){n=a(G[0]).clone(),n.css(d).addClass("ag-no-transition"),h.append(n);var i=n[0].offsetWidth;return n.remove(),{no:Math.floor((t+12)/i),width:i}}var o="auto"==F.gridNo?F.gridWidth:Math.floor(t/F.gridNo)-F.gutterSize,e="auto"==F.gridNo?Math.floor(t/(o+F.gutterSize)):F.gridNo,r=t%(o+F.gutterSize)+F.gutterSize;return o+=Math.floor(r/e),{no:e,width:o}}function C(t,i){var r=i.beforeLoad||n.noop,a=i.onLoad||n.noop,d=i.isLoaded||n.noop,l=i.onFullLoad||n.noop,s=i.ignoreCheck||n.noop,c=t.find("img"),f=[];e(c).forEach(function(n){r(n),o(n)||s(n)?d(n):f.push(u(function(t,i){n.onload=function(){a(n),t()},n.onerror=i}))}),f.length?u.all(f).then(l,l):setTimeout(function(){l()},0)}function w(){var t,i=v(),o=i.width,r=i.no,s=[];for(t=0;r>t;t++)s.push(0);e(G).forEach(function(n){var t=l(n);e(t.find("img")).forEach(function(n){var i=a(n);if(i.hasClass("img-loaded"))return void i.css("height","");t.addClass("ag-no-transition"),t.css("width",o+"px");var e=i.attr("actual-width")||i.attr("data-actual-width"),r=i.attr("actual-height")||i.attr("data-actual-height");e&&r&&i.css("height",r*n.width/e+"px")}),t.removeClass("ag-no-transition")});var c=G.clone();c.addClass("ag-no-transition");var u=n.extend({},d);u.width=o+"px",c.css(u),h.append(c),C(c,{ignoreCheck:function(n){return!l(n).hasClass("img-loaded")},onFullLoad:function(){var n,t,i,e=[];for(t=0,i=c.length;i>t;t++)e.push(c[t].offsetHeight);for(t=0,i=G.length;i>t;t++){n=l(G[t]);var r=e[t],a=Math.min.apply(Math,s),d=s.indexOf(a);s[d]=a+r+F.gutterSize;var u=d*(o+F.gutterSize),f={position:"absolute",top:a+"px"};"rtol"==F.direction?f.right=u+"px":f.left=u+"px",f.width=o+"px",n.css(f).addClass("angular-grid-item")}h.css("height",Math.max.apply(Math,s)+"px"),c.remove()}})}function y(){var n=!1;e(G).forEach(function(t){var i=a(t),o=i.find("img");o.length&&(i.addClass("img-loading"),C(i,{beforeLoad:function(n){l(n).addClass("img-loading")},isLoaded:function(n){l(n).removeClass("img-loading").addClass("img-loaded")},onLoad:function(t){!n&&F.refreshOnImgLoad&&(n=!0,s(function(){w(),n=!1},100)),l(t).removeClass("img-loading").addClass("img-loaded")},onFullLoad:function(){i.removeClass("img-loading").addClass("img-loaded")}}))})}function E(){var n=e(G).filter(function(n){return l(n).hasClass("ng-leave")});return u(function(t){n.length?l(n[0]).one("webkitTransitionEnd transitionend msTransitionEnd oTransitionEnd",function(){s(function(){G=h.children(),t()})}):t()})}function L(){s(function(){G=h.children(),E().then(function(){y(),s(function(){w()})})})}function S(){p(),G&&w()}function x(){var n=b.offsetWidth;j!=n&&(j=n,H&&s.cancel(H),H=s(function(){w()},100))}function z(){if(N=M?I.scrollTop:t.scrollY,T=M?I.offsetHeight:Math.max(document.documentElement.clientHeight,t.innerHeight||0),A=M?I.scrollHeight:Math.max(k.scrollHeight,k.offsetHeight,O.clientHeight,O.scrollHeight,O.offsetHeight||0),N+1500>=A-T){I.removeEventListener("scroll",z);var n=g.infiniteScroll();n.then(function(n){I.addEventListener("scroll",z)})}}var G,H,M,b=h[0],W=a(c),$=m.angularGridId,k=document.body,O=document.documentElement,I=document,N=0,T=0,A=0;h.addClass("angular-grid");var F;p(),g.$watch("model",L,!0),g.$watch("options",S,!0),Object.keys(r).forEach(function(n){g[n]!=i&&g.$watch(n,S)});var j=b.offsetWidth;if(W.on("resize",x),"undefined"!=typeof m.infiniteScroll){if(m.infiniteScrollContainer){var q=document.querySelectorAll(m.infiniteScrollContainer);q.length?e(q).forEach(function(n){I=l(n)[0],M=!0}):(console.error("No element exists matching the '"+m.infiniteScrollContainer+"' selector."),I=document,M=!1)}else I=document,M=!1;I.addEventListener("scroll",z)}$&&(f[$]={refresh:function(){L()}}),g.$on("$destroy",function(){$&&delete f[$],W.off("resize",x),I.removeEventListener("scroll",z)})}}}]).factory("angularGridInstance",function(){var n={};return n})}(angular,window);
